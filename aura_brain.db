import sqlite3
import pandas as pd
import os

def init_db():
    """Crea la estructura de la base de datos de Aura."""
    conn = sqlite3.connect('aura_brain.db')
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS prices (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            description TEXT NOT NULL,
            cpt_code TEXT,
            low_price REAL NOT NULL,
            high_price REAL,
            state TEXT NOT NULL,
            zip_code TEXT NOT NULL,
            county TEXT,
            provider_type TEXT, 
            source_file TEXT,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    conn.commit()
    conn.close()
    print("✅ Base de datos AURA_BRAIN inicializada con soporte nacional.")

def import_initial_knowledge():
    """Inyecta el conocimiento base de códigos 2026 (AMA/ADA)."""
    conn = sqlite3.connect('aura_brain.db')
    # Datos de ejemplo para inicializar la lógica de ahorro
    data = [
        ('Root Canal + Corona', 'D3330', 900.00, 2500.00, 'FL', '33101', 'Miami-Dade', 'Dental'),
        ('Root Canal + Corona', 'D3330', 850.00, 2400.00, 'TX', '73301', 'Travis', 'Dental'),
        ('Root Canal + Corona', 'D3330', 780.00, 2200.00, 'OH', '43001', 'Licking', 'Dental'),
        ('Digital Health Monitoring 2026', '98975', 50.00, 150.00, 'NY', '10001', 'New York', 'Medical'),
        ('Leg Revascularization', '37220', 4500.00, 12000.00, 'CA', '90001', 'Los Angeles', 'Medical')
    ]
    cursor = conn.cursor()
    cursor.executemany('''
        INSERT INTO prices (description, cpt_code, low_price, high_price, state, zip_code, county, provider_type)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)''', data)
    conn.commit()
    conn.close()

if __name__ == "__main__":
    init_db()
    import_initial_knowledge()
