<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA by May Roga LLC</title>
    <style>
        body { font-family: 'Segoe UI', Arial; background: #000; color: #fff; margin: 0; text-align: center; }
        .marquee { background: #001a33; border-bottom: 2px solid #00d4ff; padding: 15px; color: #00d4ff; font-weight: bold; overflow: hidden; white-space: nowrap; }
        .container { max-width: 900px; margin: 20px auto; padding: 25px; border: 3px solid #00d4ff; border-radius: 40px; background: #080808; }
        .login-box { margin: 20px auto; padding: 20px; border: 1px solid #00d4ff; border-radius: 20px; max-width: 350px; background: #0a0a0a; }
        input { padding: 15px; border-radius: 12px; border: 2px solid #00d4ff; background: #000; color: #fff; width: 85%; margin: 10px 0; }
        .btn-pay { background: #00d4ff; color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 90%; transition: 0.3s; margin: 5px; }
        .res-box { text-align: left; padding: 25px; border: 1px dashed #00d4ff; background: #050505; margin-top: 25px; display: none; border-radius: 20px; line-height: 1.6; }
        .doubt-section { margin-top: 20px; border: 1px solid #ffff00; padding: 20px; border-radius: 20px; display: none; }
    </style>
</head>
<body>

<div class="marquee">AURA BY MAY ROGA LLC: ESTIMADOS DE PRECIOS MÉDICOS PARA CONSUMIDORES • TRANSPARENCIA TOTAL • NO SOMOS MÉDICOS NI ASEGURADORAS</div>

<div class="container">
    <h1 style="color: #00d4ff; font-size: 3.5rem; margin: 0;">AURA</h1>
    <div style="color: #ffff00; font-weight: bold;">by May Roga LLC</div>

    <div id="login-admin-section" class="login-box">
        <input type="text" id="admin-user" placeholder="Usuario Admin">
        <input type="password" id="admin-pass" placeholder="Contraseña Admin">
        <button class="btn-pay" onclick="loginAdmin()">ACCEDER (ADMIN)</button>
    </div>

    <div id="paywall">
        <h3>Seleccione su Plan de Acceso</h3>
        <button class="btn-pay" onclick="pagar('rapido')">Consulta Rápida ($5.99)</button>
        <button class="btn-pay" onclick="pagar('standard')">Standard ($9.99)</button>
        <button class="btn-pay" onclick="pagar('special')">Especial / Premium ($19.99)</button>
    </div>

    <div id="sistema-aura" style="display:none;">
        <p id="geo-txt" style="color:#ffff00; font-size: 0.9rem;"></p>
        <div style="margin: 20px 0;">
            <button onclick="changeLang('es')" style="background:none; border:1px solid #fff; color:#fff; cursor:pointer;">ES</button>
            <button onclick="changeLang('en')" style="background:none; border:1px solid #fff; color:#fff; cursor:pointer;">EN</button>
        </div>
        <input type="text" id="q" placeholder="¿Qué procedimiento busca? (Ej: MRI, D2750)">
        <button class="btn-pay" style="font-size:1.5rem;" onclick="getEstimate()">REVELAR COMPARATIVA 3-3-5-1</button>
        
        <div id="res" class="res-box"></div>

        <div id="export-bar" style="display:none; margin-top:20px;">
            <button class="btn-pay" style="width:auto;" onclick="window.print()">Imprimir / PDF</button>
            <button class="btn-pay" style="width:auto; background:#ffff00;" onclick="readOut()">Escuchar</button>
        </div>

        <div id="doubt-section" class="doubt-section">
            <h4 style="color:#ffff00;">Aclarar Dudas con Aura</h4>
            <input type="text" id="doubt-q" placeholder="Escriba su duda aquí...">
            <button class="btn-pay" onclick="askAura()">Enviar Pregunta</button>
            <p id="doubt-res" style="color:#00d4ff; margin-top:10px;"></p>
        </div>
    </div>
</div>

<script>
    let currentLang = 'es';
    let userZip = "";

    // Detección automática de ubicación
    navigator.geolocation.getCurrentPosition(async pos => {
        try {
            const r = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=es`);
            const d = await r.json();
            userZip = d.postcode || "";
            document.getElementById('geo-info').innerText = "Ubicación: " + userZip;
        } catch(e) {}
    });

    // Función para tu entrada de administrador
    async function loginAdmin() {
        const user = document.getElementById('admin-user').value;
        const pw = document.getElementById('admin-pass').value;
        const fd = new FormData();
        fd.append("user", user);
        fd.append("pw", pw);

        const r = await fetch("/login-admin", { method: "POST", body: fd });
        if(r.ok) {
            document.getElementById('paywall').style.display = 'none';
            document.getElementById('login-admin-section').style.display = 'none';
            document.getElementById('sistema-aura').style.display = 'block';
        } else {
            alert("Usuario o Contraseña de Admin Incorrectos.");
        }
    }

    // Si viene de pago exitoso de Stripe
    if(window.location.search.includes('success')) {
        document.getElementById('paywall').style.display = 'none';
        document.getElementById('login-admin-section').style.display = 'none';
        document.getElementById('sistema-aura').style.display = 'block';
    }

    async function getEstimate() {
        const q = document.getElementById('q').value;
        const resBox = document.getElementById('res');
        resBox.style.display = 'block';
        resBox.innerHTML = "Aura está analizando el mercado para usted...";

        const fd = new FormData();
        fd.append("consulta", q);
        fd.append("lang", currentLang);
        fd.append("zip_user", userZip);

        const r = await fetch("/estimado", { method: "POST", body: fd });
        const d = await r.json();
        resBox.innerHTML = d.resultado;
        document.getElementById('export-bar').style.display = 'block';
        document.getElementById('doubt-section').style.display = 'block';
    }

    async function askAura() {
        const q = document.getElementById('doubt-q').value;
        const ctx = document.getElementById('res').innerText;
        document.getElementById('doubt-res').innerText = "Aura está respondiendo...";

        const fd = new FormData();
        fd.append("pregunta", q);
        fd.append("contexto", ctx);
        fd.append("lang", currentLang);

        const r = await fetch("/aclarar-duda", { method: "POST", body: fd });
        const d = await r.json();
        document.getElementById('doubt-res').innerHTML = "<strong>Respuesta:</strong> " + d.resultado;
    }

    function readOut() { 
        const u = new SpeechSynthesisUtterance(document.getElementById('res').innerText); 
        u.lang = currentLang === 'es' ? 'es-US' : 'en-US';
        window.speechSynthesis.speak(u); 
    }

    async function pagar(plan) {
        const fd = new FormData();
        fd.append("plan", plan);
        const r = await fetch("/create-checkout-session", { method: "POST", body: fd });
        const d = await r.json();
        if(d.url) window.location.href = d.url;
    }
</script>
</body>
</html>
