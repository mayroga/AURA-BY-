<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA by May Roga LLC</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; text-align: center; }
        .marquee { background: #001a33; border-bottom: 2px solid #00d4ff; overflow: hidden; white-space: nowrap; padding: 15px 0; font-weight: 900; color: #00d4ff; }
        .container { max-width: 950px; margin: auto; padding: 20px; border: 2px solid #00d4ff; border-radius: 30px; background: #050505; margin-top: 20px; }
        .hero-title { font-size: 3.5rem; color: #00d4ff; margin: 0; }
        .search-box { width: 80%; padding: 20px; border-radius: 15px; border: 2px solid #00d4ff; background: #000; color: #fff; font-size: 1.2rem; }
        .btn-main { background: #00d4ff; color: #000; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.2rem; margin: 10px; }
        .res-box { text-align: left; padding: 30px; background: #0a0a0a; border: 1px dashed #00d4ff; margin-top: 20px; display: none; line-height: 1.6; border-radius: 20px; }
        .doubt-box { margin-top: 20px; padding: 20px; border: 1px solid #ffff00; border-radius: 20px; display: none; }
        .btn-alt { background: #ffff00; color: #000; border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        /* Estilos para impresión */
        @media print {
            body { background: white; color: black; }
            .container { border: none; }
            .btn-main, .marquee, .search-box, .btn-alt { display: none; }
        }
    </style>
</head>
<body>

<div class="marquee">AURA BY MAY ROGA LLC • TRANSPARENCIA EN PRECIOS MÉDICOS • CONSULTORÍA PROFESIONAL • DATOS DE MERCADO USA</div>

<div class="container">
    <h1 class="hero-title">AURA</h1>
    <div style="color:#ffff00; font-weight: bold;">by May Roga LLC</div>

    <div id="setup-lang" style="margin: 20px;">
        <button class="btn-alt" onclick="setLang('es')">Español</button>
        <button class="btn-alt" onclick="setLang('en')">English</button>
    </div>

    <div id="paywall">
        <h3>Seleccione su nivel de acceso para revelar precios</h3>
        <button class="btn-main" onclick="pagar('rapido')">Acceso Rápido ($5.99)</button>
        <button class="btn-main" onclick="pagar('standard')">Standard ($9.99)</button>
        <button class="btn-main" onclick="pagar('special')">Premium ($19.99)</button>
    </div>

    <div id="sistema-aura" style="display:none;">
        <p id="geo-info" style="color:#ffff00;"></p>
        <input type="text" id="q" class="search-box" placeholder="Ej: MRI lumbar, Limpieza Dental, CPT 99213...">
        <br>
        <button class="btn-main" onclick="getEstimate()">REVELAR COMPARATIVA 3-3-5-1</button>
        
        <div id="res" class="res-box"></div>

        <div id="actions" style="display:none; margin-top: 20px;">
            <button class="btn-alt" onclick="window.print()">Generar PDF / Imprimir</button>
            <button class="btn-alt" onclick="speakRes()">Escuchar</button>
        </div>

        <div id="doubt-section" class="doubt-box">
            <h4 style="color:#ffff00;">¿Tiene dudas sobre este resultado?</h4>
            <input type="text" id="doubt-q" style="width:70%; padding:10px; border-radius:10px;" placeholder="Pregunte a Aura algo más...">
            <button class="btn-main" style="padding:10px;" onclick="askAura()">Aclarar Duda</button>
            <div id="doubt-res" style="margin-top:10px; font-style: italic; color:#00d4ff;"></div>
        </div>
    </div>
</div>

<script>
    let currentLang = 'es';
    let userZip = "";

    // Detección de ubicación
    navigator.geolocation.getCurrentPosition(async p => {
        const r = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&localityLanguage=en`);
        const d = await r.json();
        userZip = d.postcode;
        document.getElementById('geo-info').innerText = "Ubicación Detectada: " + userZip;
    });

    // Manejo de idioma
    function setLang(l) { currentLang = l; alert("Idioma cambiado a: " + l); }

    // Simulación de éxito de pago (Para desarrollo, en producción viene de la URL)
    if(window.location.search.includes('success')) {
        document.getElementById('paywall').style.display = 'none';
        document.getElementById('sistema-aura').style.display = 'block';
    }

    async function getEstimate() {
        const q = document.getElementById('q').value;
        const resDiv = document.getElementById('res');
        resDiv.style.display = 'block';
        resDiv.innerHTML = "Aura consultando bases de datos y analizando mercado...";

        const fd = new FormData();
        fd.append("consulta", q);
        fd.append("lang", currentLang);
        fd.append("zip_user", userZip);

        const r = await fetch("/estimado", { method: "POST", body: fd });
        const d = await r.json();
        resDiv.innerHTML = d.resultado;
        document.getElementById('actions').style.display = 'block';
        document.getElementById('doubt-section').style.display = 'block';
    }

    async function askAura() {
        const doubt = document.getElementById('doubt-q').value;
        const contexto = document.getElementById('res').innerText;
        const resDoubt = document.getElementById('doubt-res');
        resDoubt.innerText = "Aura procesando su consulta adicional...";

        const fd = new FormData();
        fd.append("pregunta", doubt);
        fd.append("contexto", contexto);
        fd.append("lang", currentLang);

        const r = await fetch("/aclarar-duda", { method: "POST", body: fd });
        const d = await r.json();
        resDoubt.innerHTML = "<strong>Respuesta:</strong> " + d.resultado;
    }

    function speakRes() {
        const msg = new SpeechSynthesisUtterance(document.getElementById('res').innerText);
        msg.lang = currentLang === 'es' ? 'es-US' : 'en-US';
        window.speechSynthesis.speak(msg);
    }

    async function pagar(plan) {
        const fd = new FormData();
        fd.append("plan", plan);
        const r = await fetch("/create-checkout-session", { method: "POST", body: fd });
        const d = await r.json();
        if(d.url) window.location.href = d.url;
    }
</script>
</body>
</html>
